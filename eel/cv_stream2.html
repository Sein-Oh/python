<!DOCTYPE html>
<html>

<head>
    <title>Streaming from OpenCV</title>
</head>

<body>
    <img id='view' draggable="false">
</body>
<script type="text/javascript" src="/eel.js"></script>
<script>
    const view = document.getElementById('view');
    const view_pos = view.getBoundingClientRect();
    view.addEventListener('mousedown', mousedown);
    view.addEventListener('mousemove', mousemove);
    view.addEventListener('mouseup', mouseup);
    view.addEventListener('touchstart', mousedown);
    view.addEventListener('touchmove', mousemove);
    view.addEventListener('touchend', mouseup);

    eel.expose(js_imshow);
    function js_imshow(imgdata) {
        view.src = "data:image/jpeg;base64," + imgdata;
    }

    function mouse_or_touch(event) {
        try {
            x = Math.round(event.touches[0].clientX - view_pos.left);
            y = Math.round(event.touches[0].clientY - view_pos.top);
        } catch {
            x = Math.round(event.clientX - view_pos.left);
            y = Math.round(event.clientY - view_pos.top);
        }
        return [x,y];
    }

    let mouse_on_down;
    function mousedown(event) {
        mouse_on_down = true;
        const pos = mouse_or_touch(event);
        eel.mouse_handler(["mousedown", pos[0], pos[1]]);
    }

    function mousemove(evt) {
        if (mouse_on_down === true) {
            const pos = mouse_or_touch(event);
            eel.mouse_handler(["mousemove", pos[0], pos[1]]);
        }
    }

    function mouseup(evt) {
        mouse_on_down = false
        const pos = mouse_or_touch(event);
        eel.mouse_handler(["mouseup", pos[0], pos[1]]);
    }
</script>

</html>
