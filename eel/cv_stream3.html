<!DOCTYPE html>
<html>

<head>
    <title>Streaming from OpenCV</title>
</head>

<body>
    <button onclick="start_stream()">Start</button>
    <button onclick="stop_stream()">Stop</button>
    <br>
    <img id='view' draggable="false">
</body>
<script type="text/javascript" src="/eel.js"></script>
<script>
    let stream_on, stream_id;
    const view = document.getElementById('view');
    view.addEventListener('mousedown', mouse);
    view.addEventListener('mousemove', mouse);
    view.addEventListener('mouseup', mouse);

    let on_mouse = false;
    function mouse(evt){
        if(evt.type == 'mousedown') on_mouse = true;
        else if(evt.type == 'mouseup') on_mouse = false;
        if (on_mouse === true){
            eel.mouse_event(evt.type + "," + evt.clientX + "," + evt.clientY);
        }
    }
    function stream() {
        if (stream_on === true) {
            eel.send_img()(data => {
                view.src = "data:image/jpeg;base64," + data;
            });
            stream_id = setTimeout(stream, 33);
        }
    }

    function start_stream() {
        stream_on = true;
        stream();
    }

    function stop_stream() {
        stream_on = false;
        clearTimeout(stream_id);
    }
</script>

</html>
